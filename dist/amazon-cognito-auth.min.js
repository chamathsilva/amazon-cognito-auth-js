/*!
 * Copyright 2017 Amazon.com,
 * Inc. or its affiliates. All Rights Reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the
 * License. A copy of the License is located at
 * 
 *      http://aws.amazon.com/apache2.0/
 * 
 * or in the "license" file accompanying this file. This file is
 * distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 * CONDITIONS OF ANY KIND, express or implied. See the License
 * for the specific language governing permissions and
 * limitations under the License. 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AmazonCognitoIdentity=t():e.AmazonCognitoIdentity=t()}(this,function(){return function(e){function t(s){if(n[s])return n[s].exports;var o=n[s]={exports:{},id:s,loaded:!1};return e[s].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0});var o=n(10);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});s(o);/*!
	 * Amazon Cognito Auth SDK for JavaScript
	 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
	
	 * Licensed under the Apache License, Version 2.0 (the "License").
	 * You may not use this file except in compliance with the License.
	 * A copy of the License is located at
	 *
	 *         http://aws.amazon.com/apache2.0/
	 *
	 * or in the "license" file accompanying this file.
	 * This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES
	 * OR CONDITIONS OF ANY KIND, either express or implied. See the
	 * License for the specific language governing permissions
	 * and limitations under the License.
	 */
"undefined"!=typeof window&&!window.crypto&&window.msCrypto&&(window.crypto=window.msCrypto)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=function(){function e(t){n(this,e),this.jwtToken=t||"",this.payload=this.decodePayload()}return s(e,[{key:"getJwtToken",value:function(){return this.jwtToken}},{key:"setJwtToken",value:function(e){this.jwtToken=e}},{key:"getExpiration",value:function(){if(null!==this.jwtToken){var e=this.jwtToken.split(".")[1];return JSON.parse(atob(e)).exp}}},{key:"getUsername",value:function(){if(null!==this.jwtToken){var e=this.jwtToken.split(".")[1];return JSON.parse(atob(e)).username}}},{key:"decodePayload",value:function(){var e=this.jwtToken.split(".")[1];try{return JSON.parse(atob(e))}catch(e){return{}}}}]),e}();t.default=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=function(){function e(t){n(this,e),this.jwtToken=t||"",this.payload=this.decodePayload()}return s(e,[{key:"getJwtToken",value:function(){return this.jwtToken}},{key:"setJwtToken",value:function(e){this.jwtToken=e}},{key:"getExpiration",value:function(){if(null!==this.jwtToken){var e=this.jwtToken.split(".")[1];return JSON.parse(atob(e)).exp}}},{key:"decodePayload",value:function(){var e=this.jwtToken.split(".")[1];try{return JSON.parse(atob(e))}catch(e){return{}}}}]),e}();t.default=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=function(){function e(t){n(this,e),this.refreshToken=t||""}return s(e,[{key:"getToken",value:function(){return this.refreshToken}},{key:"setToken",value:function(e){this.refreshToken=e}}]),e}();t.default=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=function(){function e(t){n(this,e),this.tokenScopes=t||[]}return s(e,[{key:"getScopes",value:function(){return this.tokenScopes}},{key:"setTokenScopes",value:function(e){this.tokenScopes=e}}]),e}();t.default=o},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=n(4),a=s(i),u=n(1),c=s(u),h=n(2),g=s(h),l=n(3),f=s(l),p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.IdToken,s=t.RefreshToken,r=t.AccessToken,i=t.TokenScopes,u=t.State;o(this,e),n?this.idToken=n:this.idToken=new g.default,s?this.refreshToken=s:this.refreshToken=new f.default,r?this.accessToken=r:this.accessToken=new c.default,i?this.tokenScopes=i:this.tokenScopes=new a.default,u?this.state=u:this.state=null}return r(e,[{key:"getIdToken",value:function(){return this.idToken}},{key:"setIdToken",value:function(e){this.idToken=e}},{key:"getRefreshToken",value:function(){return this.refreshToken}},{key:"setRefreshToken",value:function(e){this.refreshToken=e}},{key:"getAccessToken",value:function(){return this.accessToken}},{key:"setAccessToken",value:function(e){this.accessToken=e}},{key:"getTokenScopes",value:function(){return this.tokenScopes}},{key:"setTokenScopes",value:function(e){this.tokenScopes=e}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e){this.state=e}},{key:"isValid",value:function(){var e=Math.floor(new Date/1e3);try{return null!=this.accessToken?e<this.accessToken.getExpiration():null!=this.idToken&&e<this.idToken.getExpiration()}catch(e){return!1}}}]),e}();t.default=p},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o={},r=function(){function e(){n(this,e)}return s(e,null,[{key:"setItem",value:function(e,t){return o[e]=t,o[e]}},{key:"getItem",value:function(e){return Object.prototype.hasOwnProperty.call(o,e)?o[e]:void 0}},{key:"removeItem",value:function(e){return delete o[e]}},{key:"clear",value:function(){return o={}}}]),e}(),i=function(){function e(){n(this,e);try{this.storageWindow=window.localStorage,this.storageWindow.setItem("aws.cognito.test-ls",1),this.storageWindow.removeItem("aws.cognito.test-ls")}catch(e){this.storageWindow=r}}return s(e,[{key:"getStorage",value:function(){return this.storageWindow}}]),e}();t.default=i},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function s(o,r){try{var i=t[o](r),a=i.value}catch(e){return void n(e)}return i.done?void e(a):Promise.resolve(a).then(function(e){s("next",e)},function(e){s("throw",e)})}return s("next")})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=n(4),c=s(u),h=n(1),g=s(h),l=n(2),f=s(l),p=n(3),d=s(p),C=n(5),S=s(C),T=n(6),v=s(T),y=function(){function e(t){r(this,e);var n=t||{},s=n.ClientId,o=n.AppWebDomain,i=n.TokenScopesArray,a=n.RedirectUriSignIn,u=n.RedirectUriSignOut,h=n.IdentityProvider,g=n.UserPoolId,l=n.AdvancedSecurityDataCollectionFlag,f=n.Storage;if(!(null!=t&&s&&o&&a&&u))throw new Error(this.getCognitoConstants().PARAMETERERROR);if(this.clientId=s,this.appWebDomain=o,this.TokenScopesArray=i||[],!Array.isArray(i))throw new Error(this.getCognitoConstants().SCOPETYPEERROR);var p=new c.default(this.TokenScopesArray);this.RedirectUriSignIn=a,this.RedirectUriSignOut=u,this.IdentityProvider=h,this.responseType=this.getCognitoConstants().TOKEN,this.storage=f||(new v.default).getStorage(),this.username=this.getLastUser(),this.userPoolId=g,this.signInUserSession=this.getCachedSession(),+this.signInUserSession.setTokenScopes(p),this.advancedSecurityDataCollectionFlag=!0,l&&(this.advancedSecurityDataCollectionFlag=l)}return a(e,[{key:"getCognitoConstants",value:function(){var e={DOMAIN_SCHEME:"https",DOMAIN_PATH_SIGNIN:"oauth2/authorize",DOMAIN_PATH_TOKEN:"oauth2/token",DOMAIN_PATH_SIGNOUT:"logout",DOMAIN_QUERY_PARAM_REDIRECT_URI:"redirect_uri",DOMAIN_QUERY_PARAM_SIGNOUT_URI:"logout_uri",DOMAIN_QUERY_PARAM_RESPONSE_TYPE:"response_type",DOMAIN_QUERY_PARAM_IDENTITY_PROVIDER:"identity_provider",DOMAIN_QUERY_PARAM_USERCONTEXTDATA:"userContextData",CLIENT_ID:"client_id",STATE:"state",SCOPE:"scope",TOKEN:"token",CODE:"code",POST:"POST",PARAMETERERROR:"The parameters: App client Id, App web domain, the redirect URL when you are signed in and the redirect URL when you are signed out are required.",SCOPETYPEERROR:"Scopes have to be array type. ",QUESTIONMARK:"?",POUNDSIGN:"#",COLONDOUBLESLASH:"://",SLASH:"/",AMPERSAND:"&",EQUALSIGN:"=",SPACE:" ",CONTENTTYPE:"Content-Type",CONTENTTYPEVALUE:"application/x-www-form-urlencoded",AUTHORIZATIONCODE:"authorization_code",IDTOKEN:"id_token",ACCESSTOKEN:"access_token",REFRESHTOKEN:"refresh_token",ERROR:"error",ERROR_DESCRIPTION:"error_description",STRINGTYPE:"string",STATELENGTH:32,STATEORIGINSTRING:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",WITHCREDENTIALS:"withCredentials",UNDEFINED:"undefined",SELF:"_self",HOSTNAMEREGEX:/:\/\/([0-9]?\.)?(.[^\/:]+)/i,QUERYPARAMETERREGEX1:/#(.+)/,QUERYPARAMETERREGEX2:/=(.+)/,HEADER:{"Content-Type":"application/x-www-form-urlencoded"}};return e}},{key:"getClientId",value:function(){return this.clientId}},{key:"getAppWebDomain",value:function(){return this.appWebDomain}},{key:"getCurrentUser",value:function(){var e="CognitoIdentityServiceProvider."+this.clientId+".LastAuthUser",t=this.storage.getItem(e);return t}},{key:"setUser",value:function(e){this.username=e}},{key:"useCodeGrantFlow",value:function(){this.responseType=this.getCognitoConstants().CODE}},{key:"useImplicitFlow",value:function(){this.responseType=this.getCognitoConstants().TOKEN}},{key:"getSignInUserSession",value:function(){return this.signInUserSession}},{key:"getUsername",value:function(){return this.username}},{key:"setUsername",value:function(e){this.username=e}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e){this.state=e}},{key:"getSession",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,n,s,o,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Set(this.TokenScopesArray),n=new Set(this.signInUserSession.tokenScopes.getScopes()),s=this.getFQDNSignIn(),null==this.signInUserSession||!this.signInUserSession.isValid()){e.next=5;break}return e.abrupt("return",this.signInUserSession);case 5:if(this.signInUserSession=this.getCachedSession(),this.compareSets(t,n)){e.next=18;break}o=new c.default(this.TokenScopesArray),r=new f.default,i=new g.default,a=new d.default,this.signInUserSession.setTokenScopes(o),this.signInUserSession.setIdToken(r),this.signInUserSession.setAccessToken(i),this.signInUserSession.setRefreshToken(a),this.launchUri(s),e.next=29;break;case 18:if(!this.signInUserSession.isValid()){e.next=22;break}return e.abrupt("return",this.signInUserSession);case 22:if(this.signInUserSession.getRefreshToken()&&this.signInUserSession.getRefreshToken().getToken()){e.next=26;break}this.launchUri(s),e.next=29;break;case 26:return e.next=28,this.refreshSession(this.signInUserSession.getRefreshToken().getToken());case 28:return e.abrupt("return",this.signInUserSession);case 29:throw void 0;case 30:case"end":return e.stop()}},e,this)}));return e}()},{key:"startSession",value:function(){var e=this.getFQDNSignIn(),t=new c.default(this.TokenScopesArray),n=new f.default,s=new g.default,o=new d.default;this.signInUserSession.setTokenScopes(t),this.signInUserSession.setIdToken(n),this.signInUserSession.setAccessToken(s),this.signInUserSession.setRefreshToken(o),this.launchUri(e)}},{key:"parseCognitoWebResponse",value:function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var n,s,o,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,!(t.indexOf(this.getCognitoConstants().QUESTIONMARK)>-1)){e.next=10;break}return s=t.split(this.getCognitoConstants().POUNDSIGN)[0],n=this.getQueryParameters(s,this.getCognitoConstants().QUESTIONMARK),e.next=6,this.getCodeQueryParameter(n);case 6:return o=e.sent,e.abrupt("return",o);case 10:if(!(t.indexOf(this.getCognitoConstants().POUNDSIGN)>-1)){e.next=18;break}if(n=this.getQueryParameters(t,this.getCognitoConstants().QUERYPARAMETERREGEX1),!n.has(this.getCognitoConstants().ERROR)){e.next=14;break}return e.abrupt("return",this.userhandler.onFailure(n.get(this.getCognitoConstants().ERROR_DESCRIPTION)));case 14:return e.next=16,this.getTokenQueryParameter(n);case 16:return r=e.sent,e.abrupt("return",r);case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"getCodeQueryParameter",value:function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var n,s,o,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,t.has(this.getCognitoConstants().STATE)?this.signInUserSession.setState(t.get(this.getCognitoConstants().STATE)):this.signInUserSession.setState(n),!t.has(this.getCognitoConstants().CODE)){e.next=13;break}return s=t.get(this.getCognitoConstants().CODE),o=this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH,this.getAppWebDomain(),this.getCognitoConstants().SLASH,this.getCognitoConstants().DOMAIN_PATH_TOKEN),r=this.getCognitoConstants().HEADER,i={grant_type:this.getCognitoConstants().AUTHORIZATIONCODE,client_id:this.getClientId(),redirect_uri:this.RedirectUriSignIn,code:s},e.next=9,this.makePOSTRequest(r,i,o);case 9:return a=e.sent,e.next=12,this.onSuccessExchangeForToken(a);case 12:return e.abrupt("return",this.signInUserSession);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"getTokenQueryParameter",value:function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var n,s,o,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.default,s=new g.default,o=new d.default,r=null,t.has(this.getCognitoConstants().IDTOKEN)?(n.setJwtToken(t.get(this.getCognitoConstants().IDTOKEN)),this.signInUserSession.setIdToken(n)):this.signInUserSession.setIdToken(n),t.has(this.getCognitoConstants().ACCESSTOKEN)?(s.setJwtToken(t.get(this.getCognitoConstants().ACCESSTOKEN)),this.signInUserSession.setAccessToken(s)):this.signInUserSession.setAccessToken(s),t.has(this.getCognitoConstants().STATE)?this.signInUserSession.setState(t.get(this.getCognitoConstants().STATE)):this.signInUserSession.setState(r),this.cacheTokensScopes(),e.abrupt("return",this.signInUserSession);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"getCachedSession",value:function(){if(!this.username)return new S.default;var e="CognitoIdentityServiceProvider."+this.getClientId()+"."+this.username,t=e+".idToken",n=e+".accessToken",s=e+".refreshToken",o=e+".tokenScopesString",r=this.storage.getItem(o),i=[];r&&(i=r.split(" "));var a=new c.default(i),u=new f.default(this.storage.getItem(t)),h=new g.default(this.storage.getItem(n)),l=new d.default(this.storage.getItem(s)),p={IdToken:u,AccessToken:h,RefreshToken:l,TokenScopes:a},C=new S.default(p);return C}},{key:"getLastUser",value:function(){var e="CognitoIdentityServiceProvider."+this.getClientId(),t=e+".LastAuthUser",n=this.storage.getItem(t);if(n)return n}},{key:"cacheTokensScopes",value:function(){var e="CognitoIdentityServiceProvider."+this.getClientId(),t=this.signInUserSession.getAccessToken().getUsername();this.username=t;var n=e+"."+t+".idToken",s=e+"."+t+".accessToken",o=e+"."+t+".refreshToken",r=e+".LastAuthUser",i=e+"."+t+".tokenScopesString",a=this.signInUserSession.getTokenScopes().getScopes(),u=a.join(" ");this.storage.setItem(n,this.signInUserSession.getIdToken().getJwtToken()),this.storage.setItem(s,this.signInUserSession.getAccessToken().getJwtToken()),this.storage.setItem(o,this.signInUserSession.getRefreshToken().getToken()),this.storage.setItem(r,t),this.storage.setItem(i,u)}},{key:"compareSets",value:function(e,t){if(e.size!==t.size)return!1;var n=!0,s=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var a=r.value;if(!t.has(a))return!1}}catch(e){s=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(s)throw o}}return!0}},{key:"getHostName",value:function(e){var t=e.match(this.getCognitoConstants().HOSTNAMEREGEX);if(null!=t&&t.length>2&&i(t[2])===this.getCognitoConstants().STRINGTYPE&&t[2].length>0)return t[2]}},{key:"getQueryParameters",value:function(e,t){var n=String(e).split(t),s=n[1],o=String(s).split(this.getCognitoConstants().AMPERSAND),r=o.length,i=new Map,a=void 0;for(a=0;a<r;a++)o[a]=String(o[a]).split(this.getCognitoConstants().QUERYPARAMETERREGEX2),i.set(o[a][0],o[a][1]);return i}},{key:"generateRandomString",value:function(e,t){for(var n="",s=e;s>0;--s)n+=t[Math.round(Math.random()*(t.length-1))];return n}},{key:"clearCachedTokensScopes",value:function(){var e="CognitoIdentityServiceProvider."+this.getClientId(),t=e+"."+this.username+".idToken",n=e+"."+this.username+".accessToken",s=e+"."+this.username+".refreshToken",o=e+".LastAuthUser",r=e+"."+this.username+".tokenScopesString";this.storage.removeItem(t),this.storage.removeItem(n),this.storage.removeItem(s),this.storage.removeItem(o),this.storage.removeItem(r)}},{key:"refreshSession",value:function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var n,s,o,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH,this.getAppWebDomain(),this.getCognitoConstants().SLASH,this.getCognitoConstants().DOMAIN_PATH_TOKEN),s=this.getCognitoConstants().HEADER,o={grant_type:this.getCognitoConstants().REFRESHTOKEN,client_id:this.getClientId(),redirect_uri:this.RedirectUriSignIn,refresh_token:t},e.next=5,this.makePOSTRequest(s,o,n);case 5:return r=e.sent,e.next=8,this.onSuccessRefreshToken(r);case 8:return i=e.sent,e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"makePOSTRequest",value:function(e,t,n){var s=this;arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise(function(o,r){var i=s.createCORSRequest(s.getCognitoConstants().POST,n),a="";if(i){for(var u in e)i.setRequestHeader(u,e[u]);for(var c in t)a=a.concat(c,s.getCognitoConstants().EQUALSIGN,t[c],s.getCognitoConstants().AMPERSAND);a=a.substring(0,a.length-1),i.send(a),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?o(i.responseText):r(i.responseText))}}})}},{key:"createCORSRequest",value:function(e,t){var n=new XMLHttpRequest;return n.open(e,t,!0),this.getCognitoConstants().WITHCREDENTIALS in n?n.open(e,t,!0):("undefined"==typeof XDomainRequest?"undefined":i(XDomainRequest))!==this.getCognitoConstants().UNDEFINED?(n=new XDomainRequest,n.open(e,t)):n=null,n}},{key:"onFailure",value:function(e){this.userhandler.onFailure(e)}},{key:"onSuccessRefreshToken",value:function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var n,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JSON.parse(t),!Object.prototype.hasOwnProperty.call(n,this.getCognitoConstants().ERROR)){e.next=6;break}s=this.getFQDNSignIn(),this.launchUri(s),e.next=10;break;case 6:return Object.prototype.hasOwnProperty.call(n,this.getCognitoConstants().IDTOKEN)&&this.signInUserSession.setIdToken(new f.default(n.id_token)),Object.prototype.hasOwnProperty.call(n,this.getCognitoConstants().ACCESSTOKEN)&&this.signInUserSession.setAccessToken(new g.default(n.access_token)),this.cacheTokensScopes(),e.abrupt("return",this.signInUserSession);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"onSuccessExchangeForToken",value:function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var n,s,o,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JSON.parse(t),s=new d.default,o=new g.default,r=new f.default,i=null,!Object.prototype.hasOwnProperty.call(n,this.getCognitoConstants().ERROR)){e.next=7;break}throw t;case 7:return Object.prototype.hasOwnProperty.call(n,this.getCognitoConstants().IDTOKEN)?this.signInUserSession.setIdToken(new f.default(n.id_token)):this.signInUserSession.setIdToken(r),Object.prototype.hasOwnProperty.call(n,this.getCognitoConstants().ACCESSTOKEN)?this.signInUserSession.setAccessToken(new g.default(n.access_token)):this.signInUserSession.setAccessToken(o),Object.prototype.hasOwnProperty.call(n,this.getCognitoConstants().REFRESHTOKEN)?this.signInUserSession.setRefreshToken(new d.default(n.refresh_token)):this.signInUserSession.setRefreshToken(s),this.cacheTokensScopes(),e.abrupt("return",this.signInUserSession);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"launchUri",value:function(e){window.open(e,this.getCognitoConstants().SELF)}},{key:"getSpaceSeperatedScopeString",value:function(){var e=this.signInUserSession.getTokenScopes().getScopes();return e=e.join(this.getCognitoConstants().SPACE),encodeURIComponent(e)}},{key:"getFQDNSignIn",value:function(){null==this.state&&(this.state=this.generateRandomString(this.getCognitoConstants().STATELENGTH,this.getCognitoConstants().STATEORIGINSTRING));var e=this.IdentityProvider?this.getCognitoConstants().AMPERSAND.concat(this.getCognitoConstants().DOMAIN_QUERY_PARAM_IDENTITY_PROVIDER,this.getCognitoConstants().EQUALSIGN,this.IdentityProvider):"",t=this.getSpaceSeperatedScopeString(),n="",s=this.getUserContextData();s&&(n=this.getCognitoConstants().AMPERSAND+this.getCognitoConstants().DOMAIN_QUERY_PARAM_USERCONTEXTDATA+this.getCognitoConstants().EQUALSIGN+this.getUserContextData());var o=this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH,this.getAppWebDomain(),this.getCognitoConstants().SLASH,this.getCognitoConstants().DOMAIN_PATH_SIGNIN,this.getCognitoConstants().QUESTIONMARK,this.getCognitoConstants().DOMAIN_QUERY_PARAM_REDIRECT_URI,this.getCognitoConstants().EQUALSIGN,encodeURIComponent(this.RedirectUriSignIn),this.getCognitoConstants().AMPERSAND,this.getCognitoConstants().DOMAIN_QUERY_PARAM_RESPONSE_TYPE,this.getCognitoConstants().EQUALSIGN,this.responseType,this.getCognitoConstants().AMPERSAND,this.getCognitoConstants().CLIENT_ID,this.getCognitoConstants().EQUALSIGN,this.getClientId(),this.getCognitoConstants().AMPERSAND,this.getCognitoConstants().STATE,this.getCognitoConstants().EQUALSIGN,this.state,this.getCognitoConstants().AMPERSAND,this.getCognitoConstants().SCOPE,this.getCognitoConstants().EQUALSIGN,t,e,n);return o}},{key:"signOut",value:function(){var e=this.getFQDNSignOut();this.signInUserSession=null,this.clearCachedTokensScopes(),this.launchUri(e)}},{key:"getFQDNSignOut",value:function(){var e=this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH,this.getAppWebDomain(),this.getCognitoConstants().SLASH,this.getCognitoConstants().DOMAIN_PATH_SIGNOUT,this.getCognitoConstants().QUESTIONMARK,this.getCognitoConstants().DOMAIN_QUERY_PARAM_SIGNOUT_URI,this.getCognitoConstants().EQUALSIGN,encodeURIComponent(this.RedirectUriSignOut),this.getCognitoConstants().AMPERSAND,this.getCognitoConstants().CLIENT_ID,this.getCognitoConstants().EQUALSIGN,this.getClientId());return e}},{key:"getUserContextData",value:function(){if("undefined"!=typeof AmazonCognitoAdvancedSecurityData){var e="";this.username&&(e=this.username);var t="";return this.userpoolId&&(t=this.userpoolId),this.advancedSecurityDataCollectionFlag?AmazonCognitoAdvancedSecurityData.getData(e,t,this.clientId):void 0}}},{key:"isUserSignedIn",value:function(){return null!=this.signInUserSession&&this.signInUserSession.isValid()||null!=this.getCachedSession()&&this.getCachedSession().isValid()}}]),e}();t.default=y},function(e,t,n){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=n(11),a=s(i),u=function(){function e(t){o(this,e),this.domain=t.domain,t.path?this.path=t.path:this.path="/",Object.prototype.hasOwnProperty.call(t,"expires")?this.expires=t.expires:this.expires=365,Object.prototype.hasOwnProperty.call(t,"secure")?this.secure=t.secure:this.secure=!0}return r(e,[{key:"setItem",value:function(e,t){return a.set(e,t,{path:this.path,expires:this.expires,domain:this.domain,secure:this.secure}),a.get(e)}},{key:"getItem",value:function(e){return a.get(e)}},{key:"removeItem",value:function(e){return a.remove(e,{path:this.path,domain:this.domain,secure:this.secure})}},{key:"clear",value:function(){var e=a.get(),t=void 0;for(t=0;t<e.length;++t)a.remove(e[t]);return{}}}]),e}();t.default=u},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=function(){function e(){n(this,e)}return s(e,[{key:"getNowString",value:function(){var e=new Date,t=r[e.getUTCDay()],n=o[e.getUTCMonth()],s=e.getUTCDate(),i=e.getUTCHours();i<10&&(i="0"+i);var a=e.getUTCMinutes();a<10&&(a="0"+a);var u=e.getUTCSeconds();u<10&&(u="0"+u);var c=e.getUTCFullYear(),h=t+" "+n+" "+s+" "+i+":"+a+":"+u+" UTC "+c;return h}}]),e}();t.default=i},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1);Object.defineProperty(t,"CognitoAccessToken",{enumerable:!0,get:function(){return s(o).default}});var r=n(2);Object.defineProperty(t,"CognitoIdToken",{enumerable:!0,get:function(){return s(r).default}});var i=n(3);Object.defineProperty(t,"CognitoRefreshToken",{enumerable:!0,get:function(){return s(i).default}});var a=n(4);Object.defineProperty(t,"CognitoTokenScopes",{enumerable:!0,get:function(){return s(a).default}});var u=n(7);Object.defineProperty(t,"CognitoAuth",{enumerable:!0,get:function(){return s(u).default}});var c=n(5);Object.defineProperty(t,"CognitoAuthSession",{enumerable:!0,get:function(){return s(c).default}});var h=n(9);Object.defineProperty(t,"DateHelper",{enumerable:!0,get:function(){return s(h).default}});var g=n(6);Object.defineProperty(t,"StorageHelper",{enumerable:!0,get:function(){return s(g).default}});var l=n(8);Object.defineProperty(t,"CookieStorage",{enumerable:!0,get:function(){return s(l).default}})},function(e,t,n){var s,o;!function(r){var i=!1;if(s=r,o="function"==typeof s?s.call(t,n,t,e):s,!(void 0!==o&&(e.exports=o)),i=!0,e.exports=r(),i=!0,!i){var a=window.Cookies,u=window.Cookies=r();u.noConflict=function(){return window.Cookies=a,u}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var s in n)t[s]=n[s]}return t}function t(n){function s(t,o,r){var i;if("undefined"!=typeof document){if(arguments.length>1){if(r=e({path:"/"},s.defaults,r),"number"==typeof r.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*r.expires),r.expires=a}r.expires=r.expires?r.expires.toUTCString():"";try{i=JSON.stringify(o),/^[\{\[]/.test(i)&&(o=i)}catch(e){}o=n.write?n.write(o,t):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape);var u="";for(var c in r)r[c]&&(u+="; "+c,r[c]!==!0&&(u+="="+r[c]));return document.cookie=t+"="+o+u}t||(i={});for(var h=document.cookie?document.cookie.split("; "):[],g=/(%[0-9A-Z]{2})+/g,l=0;l<h.length;l++){var f=h[l].split("="),p=f.slice(1).join("=");this.json||'"'!==p.charAt(0)||(p=p.slice(1,-1));try{var d=f[0].replace(g,decodeURIComponent);if(p=n.read?n.read(p,d):n(p,d)||p.replace(g,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(e){}if(t===d){i=p;break}t||(i[d]=p)}catch(e){}}return i}}return s.set=s,s.get=function(e){return s.call(s,e)},s.getJSON=function(){return s.apply({json:!0},[].slice.call(arguments))},s.defaults={},s.remove=function(t,n){s(t,"",e(n,{expires:-1}))},s.withConverter=t,s}return t(function(){})})}])});
//# sourceMappingURL=amazon-cognito-auth.min.js.map